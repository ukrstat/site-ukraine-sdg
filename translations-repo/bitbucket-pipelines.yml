image: alpine:3.20

pipelines:
  default:
    - step:
        name: Mirror Bitbucket â†’ GitHub
        script:
          - apk add --no-cache git openssh-client
          - mkdir -p ~/.ssh
          - chmod 700 ~/.ssh

          # SSH key
          - echo "$GH_SSH_PRIVATE_KEY_64" | base64 -d > ~/.ssh/id_ed25519
          - chmod 600 ~/.ssh/id_ed25519

          # known hosts
          - ssh-keyscan bitbucket.org github.com >> ~/.ssh/known_hosts

          # clone from Bitbucket (READ)
          - git clone --mirror git@bitbucket.org:kitsoftllc/sdg-translations.git repo.git
          - cd repo.git

          # push to GitHub (WRITE)
          - export GIT_SSH_COMMAND="ssh -i ~/.ssh/id_ed25519 -o IdentitiesOnly=yes"
          - git push --mirror git@github.com:sdg-kitsoft-stg/sdg-translations.git